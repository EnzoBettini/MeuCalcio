<template><div><label for="food-item">Alimento:</label><input id="food-item" v-model="foodItem" @input="searchFoodAPI" type="text" placeholder="Digite o nome do alimento" class="form-control" autocomplete="off" /><div v-if="autocomplete.length" class="border p-2 bg-white shadow-sm"><div v-for="(item, index) in autocomplete" :key="index" @click="selectFood(item)" style="cursor:pointer">{{ item.name}} </div></div></div></template><script>export default{ data(){ return{ // 'foodItem': Armazena o texto que o usuário está digitando. Inicia vazio. foodItem: '', // 'autocomplete': Uma lista (array) para armazenar os resultados da busca da API. Inicia vazia. autocomplete: []};}, methods:{ async searchFoodAPI(){ // 1. Condição de segurança: só busca se o usuário digitou 3 ou mais letras. // Isso evita chamadas desnecessárias à API e melhora a performance. if (this.foodItem.length < 3){ this.autocomplete=[]; // Limpa a lista de sugestões se o texto for muito curto. return; // Para a execução da função aqui.} // 2. Define a consulta GraphQL que será enviada para a API. const query=` query{ getAllFood{ name nutrients{ calcium}}} `; // 3. Bloco 'try...catch' para lidar com possíveis erros de rede ou da API. try{ // 4. Faz a chamada à API usando 'fetch'. 'await' pausa a função até a resposta chegar. const response=await fetch('https://meucalcio.onrender.com/graphql',{ method: 'POST', // Método para enviar dados. headers:{ 'Content-Type': 'application/json'}, // Avisa a API que estamos enviando JSON. body: JSON.stringify({ query}) // Converte nosso objeto com a query para texto JSON.}); // 5. Verifica se a resposta da API foi bem-sucedida (ex: status 200 OK). if (!response.ok){ console.error('Erro na resposta da API:', response.status); this.autocomplete=[]; // Limpa sugestões em caso de erro. return;} // 6. Converte a resposta da API de texto JSON para um objeto JavaScript. const result=await response.json(); const foods=result.data.getAllFood; // Extrai a lista de alimentos da resposta. // 7. Filtra a lista de alimentos localmente e atualiza o estado. this.autocomplete=foods // '.filter()' cria uma nova lista apenas com os itens que passam na condição. // A condição é: o nome do alimento (em minúsculas) deve incluir o texto digitado (também em minúsculas). .filter(food=>food.name.toLowerCase().includes(this.foodItem.toLowerCase())) // '.slice(0, 10)' pega apenas os 10 primeiros resultados do filtro. .slice(0, 10);} catch (error){ // Se qualquer coisa no bloco 'try' der errado, o código pula para cá. console.error('Erro ao buscar alimentos:', error); this.autocomplete=[]; // Limpa as sugestões para o usuário.}}, selectFood(food){ // 1. Atualiza o campo de input com o nome do alimento selecionado. this.foodItem=food.name; // 2. Emite um evento chamado 'food-selected'. Isso permite que um componente "pai" // "escute" essa ação e receba os dados do alimento selecionado ('food'). // É a forma correta de comunicar "de filho para pai" em Vue. this.$emit('food-selected', food); // 3. Limpa a lista de sugestões, fazendo com que ela desapareça da tela. this.autocomplete=[];}}};</script>