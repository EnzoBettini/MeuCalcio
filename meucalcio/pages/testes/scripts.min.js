const foodItemInput=document.getElementById("food-item"),autocompleteList=document.getElementById("autocomplete-list"),foodQuantityInput=document.getElementById("food-quantity"),addFoodBtn=document.getElementById("add-food-btn"),consumedFoodsList=document.getElementById("consumed-foods-list"),calciumTotalDisplay=document.getElementById("calcium-total-display");let selectedFoodFromAPI=null,consumedFoods=[];async function searchFoodAPI(e){if(e.length<3)return void(autocompleteList.innerHTML="");try{const t=await fetch("https://meucalcio.onrender.com/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:"query { getAllFood { name nutrients { calcium } } }"})}),o=await t.json(),n=o.data.getAllFood.filter((t=>t.name.toLowerCase().includes(e.toLowerCase())));autocompleteList.innerHTML="",n.slice(0,10).forEach((e=>{const t=document.createElement("div");t.textContent=e.name,t.addEventListener("click",(()=>{foodItemInput.value=e.name,selectedFoodFromAPI=e,autocompleteList.innerHTML=""})),autocompleteList.appendChild(t)})),0===n.length&&(autocompleteList.innerHTML="<div>Nenhum alimento encontrado.</div>")}catch(e){autocompleteList.innerHTML="<div>Erro na busca.</div>"}}function addFoodItem(){const e=foodItemInput.value.trim(),t=parseFloat(foodQuantityInput.value);if(!selectedFoodFromAPI||selectedFoodFromAPI.name!==e)return void alert("Por favor, selecione um alimento da lista.");if(isNaN(t)||t<=0)return void alert("Insira uma quantidade válida.");const o=selectedFoodFromAPI.nutrients.calcium;if(void 0===o||isNaN(o))return void alert("Este alimento não possui dados de cálcio.");const n=o/100*t;consumedFoods.push({name:e,quantity:t,calcium:n}),renderConsumedFoods(),updateTotalCalcium(),foodItemInput.value="",foodQuantityInput.value=100,selectedFoodFromAPI=null,autocompleteList.innerHTML=""}function renderConsumedFoods(){consumedFoodsList.innerHTML="",consumedFoods.forEach((e=>{const t=document.createElement("li");t.textContent=`${e.name} — ${e.quantity}g — ${e.calcium.toFixed(1)} mg cálcio`,consumedFoodsList.appendChild(t)}))}function updateTotalCalcium(){const e=consumedFoods.reduce(((e,t)=>e+t.calcium),0);calciumTotalDisplay.textContent=e.toFixed(1)}foodItemInput.addEventListener("input",(()=>{searchFoodAPI(foodItemInput.value)})),addFoodBtn.addEventListener("click",addFoodItem);